---
title: "Untitled"
author: "Team Knapp"
date: "10/2/2021"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

## Problem 3 (30 Points)

In the `Credit` data in the `ISLR` package it contains 400 customers and information on their credit history.  For full information of the data look at the `help` file.  A company has approached us to better understand factors that influence the `Balance` variable which is average credit card balance in USD.  Using the information in the model discuss the influential factors, and discuss the factors you choose to put in the model.  Do you have any concerns about the use of certain variables in the model? Discuss how your model was created and any insights you can provide based on the results.  HINT:  Adding Gender and/or Ethnicity could be controversial or illegal in some uses of this this model you should discuss your decision on these variables and how it effects the organizations ability to use your model for prediction or inference.  


```{r}
library(ISLR)
head(Credit)
help(Credit)
summary(Credit)
```
#
Looking at the data, the only predictor that wouldn't be able to have a log is balance since there are zeros in the data.  No NAs present.  Interesting is there are 40 students compared with 360 non-students.
Let's plot everything against balance, with the exception of ID, Gender and Ethnicity.  
```{r}
Model1<- lm(Balance~Income + Limit + Rating + Cards + Age + Education + Student + Married, data = Credit)
Model1
summary(Model1)
```
#
The most important factors in the summary of Model1 are Income, Limit, Cards and Student.  The other variables Rating, Age, Education and Married are all insignificant according to the summary.  But, would they be significant within each predictor?

```{r}
Model1QC1<- lm(Balance~Income*Rating + Limit*Rating + Cards*Rating + Age*Rating + Education*Rating + Student*Rating + Married*Rating, data = Credit)
summary(Model1QC1)
```

```{r}
Model1QC2<- lm(Balance~Income*Age + Limit*Age + Rating*Age + Cards*Age + Education*Age + Student*Age + Married*Age, data = Credit)
summary(Model1QC2)
```

```{r}
ModelQC3<- lm(Balance~Income*Education + Limit*Education + Rating*Education + Cards*Education + Age*Education + Student*Education + Married*Education, data = Credit)
summary(ModelQC3)
```

```{r}
Model1QC4<- lm(Balance~Income*Married +Limit*Married + Rating*Married + Cards*Married + Age*Married + Education*Married + Student*Married, data = Credit)
summary(Model1QC4)
```
#
A quick check of each model using the insignificant predictor shows the only one added to be a subset of the others is rating.  Knowing this, we're not so quick to discard rating as a factor.  Total conjecture, however, usually the higher your rating is, the higher your available credit is, thus you're able to have a higher balance.
Knowing that the new model will keep rating but remove married, age and eduction as predictors.
```{r}
Model2<- lm(Balance~Income + Limit + Rating + Cards + Student, data = Credit)
summary(Model2)
```
#
Everything is significant here with the exception of rating that is coming in as the least significant.
Let's do a more exact test and see if an anova numerically tells us which is better.  We can use an anova because Model2 is a subset of the predictors in Model1.
```{r}
anova(Model1,Model2)
```
#
Interesting.  The anova test comes back with the lower score for Model1, which includes all of the predictors including those that were deemed insignificant in the summary.

Maybe something should be transformed in one of the models.  A boxcox will show us if that's necessary.
*boxcox is not working here*
```{r}
boxCox(Model1)
boxCox(Model2)
```

```{r}
plot(allEffects(Model1))
plot(allEffects(Model2))
```


Now we want to try an AIC test on Model1 and separately Model2, both backward and forward.

```{r}
AIC(Model1)
Model1TestBackward=step(Model1,direction="backward")
par(mfrow=c(2,2))
plot(Model1TestBackward)

AIC(Model1)
Model1TestForward=step(Model1,direction="forward")
par(mfrow=c(2,2))
plot(Model1TestForward)
```

```{r}
AIC(Model2)
Model2TestBackward=step(Model2,direction="backward")
par(mfrow=c(2,2))
plot(Model2TestBackward)

AIC(Model2)
Model2TestForward=step(Model2,direction="forward")
par(mfrow=c(2,2))
plot(Model2TestForward)
```
